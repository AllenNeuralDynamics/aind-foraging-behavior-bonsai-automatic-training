{
    "curriculum_schema_name": "DynamicForagingCurriculum",
    "curriculum_schema_version": "1.0",
    "curriculum_name": "Uncoupled Baiting",
    "curriculum_version": "1.0",
    "curriculum_description": "2024-02-19 Base curriculum for the uncoupled-baiting task",
    "parameters": {
        "Stage 1 w/warmup": {
            "training_stage": "Stage 1 w/warmup",
            "task": "Coupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Warmup, followed by legendary Coupled Baiting Stage 1.2 (block = [10, 30, 10], p_sum = 0.8, p_ratio = [1:0])",
            "BaseRewardSum": 0.8,
            "RewardFamily": 3,
            "RewardPairsN": 1,
            "UncoupledReward": "",
            "Randomness": "Exponential",
            "BlockMin": 10,
            "BlockMax": 30,
            "BlockBeta": 10,
            "BlockMinReward": 0,
            "DelayMin": 0.5,
            "DelayMax": 0.5,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": true,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 3,
            "Ignored": 3,
            "ITIMin": 1.0,
            "ITIMax": 7.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 5.0,
            "RewardConsumeTime": 3.0,
            "StopIgnores": 20000,
            "AdvancedBlockAuto": "now",
            "SwitchThr": 0.5,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 90,
            "RightValue_volume": 5.0,
            "LeftValue_volume": 5.0,
            "warmup": "on",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Stage 1": {
            "training_stage": "Stage 1",
            "task": "Coupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Phase B in Han's slides (block = [10, 30, 10], p_sum = 0.8, p_ratio = [1:0])",
            "BaseRewardSum": 0.8,
            "RewardFamily": 3,
            "RewardPairsN": 1,
            "UncoupledReward": "",
            "Randomness": "Exponential",
            "BlockMin": 10,
            "BlockMax": 30,
            "BlockBeta": 10,
            "BlockMinReward": 0,
            "DelayMin": 0.5,
            "DelayMax": 0.5,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": true,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 3,
            "Ignored": 3,
            "ITIMin": 1.0,
            "ITIMax": 7.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 5.0,
            "RewardConsumeTime": 3.0,
            "StopIgnores": 20000,
            "AdvancedBlockAuto": "now",
            "SwitchThr": 0.5,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 90,
            "RightValue_volume": 3.0,
            "LeftValue_volume": 3.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Stage 2": {
            "training_stage": "Stage 2",
            "task": "Coupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Coupled baiting (block = [20, 35, 10], p_sum = 0.8, p_ratio = [8:1])",
            "BaseRewardSum": 0.8,
            "RewardFamily": 1,
            "RewardPairsN": 1,
            "UncoupledReward": "",
            "Randomness": "Exponential",
            "BlockMin": 20,
            "BlockMax": 35,
            "BlockBeta": 10,
            "BlockMinReward": 0,
            "DelayMin": 1.0,
            "DelayMax": 1.0,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": true,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 3,
            "Ignored": 3,
            "ITIMin": 1.0,
            "ITIMax": 10.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 2.0,
            "RewardConsumeTime": 3.0,
            "StopIgnores": 20000,
            "AdvancedBlockAuto": "now",
            "SwitchThr": 0.5,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 90,
            "RightValue_volume": 3.0,
            "LeftValue_volume": 3.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Stage 3": {
            "training_stage": "Stage 3",
            "task": "Uncoupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Switch to uncoupled but still baiting; p_rew = [0.1, 0.4, 0.7]; turn on auto water for 1 day",
            "BaseRewardSum": 0.8,
            "RewardFamily": 1,
            "RewardPairsN": 1,
            "UncoupledReward": "0.1, 0.4, 0.7",
            "Randomness": "Exponential",
            "BlockMin": 20,
            "BlockMax": 35,
            "BlockBeta": 10,
            "BlockMinReward": 0,
            "DelayMin": 1.5,
            "DelayMax": 1.5,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": true,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 10,
            "Ignored": 1000,
            "ITIMin": 1.0,
            "ITIMax": 15.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 2.0,
            "RewardConsumeTime": 3.0,
            "StopIgnores": 20000,
            "AdvancedBlockAuto": "off",
            "SwitchThr": 0.5,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 90,
            "RightValue_volume": 3.0,
            "LeftValue_volume": 3.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Stage final": {
            "training_stage": "Stage final",
            "task": "Uncoupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Uncoupled baiting; p_rew = [0.1, 0.4, 0.7]; turn off auto water",
            "BaseRewardSum": 0.8,
            "RewardFamily": 1,
            "RewardPairsN": 1,
            "UncoupledReward": "0.1, 0.4, 0.7",
            "Randomness": "Exponential",
            "BlockMin": 20,
            "BlockMax": 35,
            "BlockBeta": 10,
            "BlockMinReward": 0,
            "DelayMin": 2.0,
            "DelayMax": 2.0,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": false,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 10,
            "Ignored": 1000,
            "ITIMin": 1.0,
            "ITIMax": 30.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 2.0,
            "RewardConsumeTime": 3.0,
            "StopIgnores": 20000,
            "AdvancedBlockAuto": "off",
            "SwitchThr": 0.5,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 90,
            "RightValue_volume": 3.0,
            "LeftValue_volume": 3.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        },
        "Graduated": {
            "training_stage": "Stage final",
            "task": "Uncoupled Baiting",
            "task_url": "https://github.com/AllenNeuralDynamics/dynamic-foraging-task",
            "task_schema_version": "1.1.0",
            "description": "Uncoupled baiting; p_rew = [0.1, 0.4, 0.7]; turn off auto water",
            "BaseRewardSum": 0.8,
            "RewardFamily": 1,
            "RewardPairsN": 1,
            "UncoupledReward": "0.1, 0.4, 0.7",
            "Randomness": "Exponential",
            "BlockMin": 20,
            "BlockMax": 35,
            "BlockBeta": 10,
            "BlockMinReward": 0,
            "DelayMin": 2.0,
            "DelayMax": 2.0,
            "DelayBeta": 0.0,
            "RewardDelay": 0.0,
            "AutoReward": false,
            "AutoWaterType": "Natural",
            "Multiplier": 0.5,
            "Unrewarded": 10,
            "Ignored": 1000,
            "ITIMin": 1.0,
            "ITIMax": 30.0,
            "ITIBeta": 3.0,
            "ITIIncrease": 0.0,
            "ResponseTime": 2.0,
            "RewardConsumeTime": 3.0,
            "StopIgnores": 20000,
            "AdvancedBlockAuto": "off",
            "SwitchThr": 0.5,
            "PointsInARow": 5,
            "MaxTrial": 1000,
            "MaxTime": 90,
            "RightValue_volume": 3.0,
            "LeftValue_volume": 3.0,
            "warmup": "off",
            "warm_min_trial": 50,
            "warm_max_choice_ratio_bias": 0.1,
            "warm_min_finish_ratio": 0.8,
            "warm_windowsize": 20
        }
    },
    "curriculum": {
        "Stage 1 w/warmup": {
            "from_stage": "Stage 1 w/warmup",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Stage 2",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] >= 200\n                        and\n                        metrics.foraging_efficiency[-1] >= 0.6\n                        ",
                    "condition_description": "Finished trials >= 200 and efficiency >= 0.6"
                },
                {
                    "decision": "progress",
                    "to_stage": "Stage 1",
                    "condition": "lambda metrics:\n                        metrics.session_at_current_stage >= 1\n                        ",
                    "condition_description": "After the first session"
                }
            ]
        },
        "Stage 1": {
            "from_stage": "Stage 1",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Stage 2",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] >= 200\n                        and\n                        metrics.foraging_efficiency[-1] >= 0.6\n                        ",
                    "condition_description": "Finished trials >= 200 and efficiency >= 0.6"
                }
            ]
        },
        "Stage 2": {
            "from_stage": "Stage 2",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Stage 3",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] >= 300\n                        and\n                        metrics.foraging_efficiency[-1] >= 0.65\n                        and\n                        metrics.session_at_current_stage >= 2\n                        ",
                    "condition_description": "Finished trials >= 300 and efficiency >= 0.65 and stay for >= 2 days"
                },
                {
                    "decision": "rollback",
                    "to_stage": "Stage 1",
                    "condition": "lambda metrics:\n                        metrics.finished_trials[-1] < 200\n                        or\n                        metrics.foraging_efficiency[-1] < 0.55\n                        ",
                    "condition_description": "Finished trials < 200 or efficiency < 0.55"
                }
            ]
        },
        "Stage 3": {
            "from_stage": "Stage 3",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Stage final",
                    "condition": "lambda metrics:\n                                metrics.session_at_current_stage >= 1\n                                ",
                    "condition_description": "Just stay for 1 day"
                }
            ]
        },
        "Stage final": {
            "from_stage": "Stage final",
            "transition_rules": [
                {
                    "decision": "progress",
                    "to_stage": "Graduated",
                    "condition": "lambda metrics:\n                        metrics.session_total >= 10 \n                        and\n                        metrics.session_at_current_stage >= 5\n                        and\n                        np.mean(metrics.finished_trials[-5:]) >= 400\n                        and\n                        np.mean(metrics.foraging_efficiency[-5:]) >= 0.67\n                        ",
                    "condition_description": "For recent 5 sessions,mean finished trials >= 400 and mean efficiency >= 0.67 and total sessions >= 10 and sessions at final >= 5"
                },
                {
                    "decision": "rollback",
                    "to_stage": "Stage 3",
                    "condition": "lambda metrics:\n                        np.mean(metrics.finished_trials[-2:]) < 300\n                        or\n                        np.mean(metrics.foraging_efficiency[-2:]) < 0.6\n                        ",
                    "condition_description": "For recent 2 sessions, mean finished trials < 300 or efficiency < 0.6"
                }
            ]
        }
    }
}